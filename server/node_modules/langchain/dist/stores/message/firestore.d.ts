import type { AppOptions } from "firebase-admin";
import { BaseMessage, BaseListChatMessageHistory } from "../../schema/index.js";
import crypto from 'crypto';

// Define your SECRET_KEY, preferably stored securely as mentioned previously
const SECRET_KEY = process.env.SECRET_KEY || crypto.randomBytes(32).toString('hex');

export function encrypt(text: string, key: string = SECRET_KEY): string {
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipheriv('aes-256-cbc', Buffer.from(key), iv);
    let encrypted = cipher.update(text);
    encrypted = Buffer.concat([encrypted, cipher.final()]);
    return iv.toString('hex') + ':' + encrypted.toString('hex');
}

export function decrypt(text: string, key: string = SECRET_KEY): string {
    const textParts = text.split(':');
    const iv = Buffer.from(textParts.shift(), 'hex');
    const encryptedText = Buffer.from(textParts.join(':'), 'hex');
    const decipher = crypto.createDecipheriv('aes-256-cbc', Buffer.from(key), iv);
    let decrypted = decipher.update(encryptedText);
    decrypted = Buffer.concat([decrypted, decipher.final()]);
    return decrypted.toString();
}
/**
 * Interface for FirestoreDBChatMessageHistory. It includes the collection
 * name, session ID, user ID, and optionally, the app index and
 * configuration for the Firebase app.
 */
export interface FirestoreDBChatMessageHistory {
    collectionName: string;
    sessionId: string;
    userId: string;
    appIdx?: number;
    config?: AppOptions;
}
/**
 * Class for managing chat message history using Google's Firestore as a
 * storage backend. Extends the BaseListChatMessageHistory class.
 */
export declare class FirestoreChatMessageHistory extends BaseListChatMessageHistory {
    lc_namespace: string[];
    private collectionName;
    private sessionId;
    private userId;
    private appIdx;
    private config;
    private firestoreClient;
    private document;
    constructor({ collectionName, sessionId, userId, appIdx, config, }: FirestoreDBChatMessageHistory);
    private ensureFirestore;
    /**
     * Method to retrieve all messages from the Firestore collection
     * associated with the current session. Returns an array of BaseMessage
     * objects.
     * @returns Array of stored messages
     */
    getMessages(): Promise<BaseMessage[]>;
    /**
     * Method to add a new message to the Firestore collection. The message is
     * passed as a BaseMessage object.
     * @param message The message to be added as a BaseMessage object.
     */
    addMessage(message: BaseMessage): Promise<void>;
    private upsertMessage;
    /**
     * Method to delete all messages from the Firestore collection associated
     * with the current session.
     */
    clear(): Promise<void>;
}
